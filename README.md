# Telegram Bot –¥–ª—è Popcorn Shop

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
–¢–µ–∫—Å—Ç–æ–≤—ã–π Telegram-–±–æ—Ç –¥–ª—è –∑–∞–∫—É—Å–æ—á–Ω–æ–π, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ TypeScript —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Telegraf.js, Supabase –∏ –≥–æ—Ç–æ–≤—ã–π –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ Vercel.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:
```bash
cp .env.example .env
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- `BOT_TOKEN` - —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ Telegram –±–æ—Ç–∞ –æ—Ç @BotFather
- `SUPABASE_URL` - URL –ø—Ä–æ–µ–∫—Ç–∞ Supabase
- `SUPABASE_ANON_KEY` - –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á Supabase
- `WEBHOOK_SECRET` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `VERCEL_URL` - –¥–æ–º–µ–Ω Vercel –¥–ª—è production

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ [Supabase](https://supabase.com)
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ —Ñ–∞–π–ª–∞ `database/schema.sql` –≤ SQL Editor
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ RLS (Row Level Security) –≤–∫–ª—é—á–µ–Ω

### 3. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–ª–æ–∫–∞–ª—å–Ω–æ)
```bash
npm install
npm run dev
```

### 4. –î–µ–ø–ª–æ–π –Ω–∞ Vercel
1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –∫ Vercel
2. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Vercel
3. –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook:
```bash
npm run set-webhook
```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –î–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π:
- üçø –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ–Ω—é —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- üõí –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω—É
- üìù –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å –≤—ã–±–æ—Ä–æ–º –±—É—Ñ–µ—Ç–∞
- üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤
- üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∑–∞–∫–∞–∑–∞

### –î–ª—è –ø—Ä–æ–¥–∞–≤—Ü–æ–≤:
- üì• –ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- üë®‚Äçüç≥ –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–∫–∞–∑–æ–≤ –≤ —Ä–∞–±–æ—Ç—É
- ‚úÖ –û—Ç–º–µ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –∫–∞–∫ –≥–æ—Ç–æ–≤—ã—Ö
- üì¶ –§–∏–∫—Å–∞—Ü–∏—è –≤—ã–¥–∞—á–∏ –∑–∞–∫–∞–∑–æ–≤

## –ö–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- `npm run dev` - –∑–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- `npm run build` - —Å–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
- `npm run set-webhook` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook
- `npm run webhook-info` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ webhook

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **–ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞** —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **RLS –ø–æ–ª–∏—Ç–∏–∫–∏** –≤ Supabase –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è race conditions
- **Graceful error handling** –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö

## –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
- üçø –ü–æ–ø–∫–æ—Ä–Ω (—Å–ª–∞–¥–∫–∏–π, —Å–æ–ª–µ–Ω—ã–π, –∫–∞—Ä–∞–º–µ–ª—å–Ω—ã–π)
- ü•§ –ù–∞–ø–∏—Ç–∫–∏ (–≥–∞–∑–∏—Ä–æ–≤–∫–∏, —Å–æ–∫–∏, –≤–æ–¥–∞)
- üç≠ –°–∞—Ö–∞—Ä–Ω–∞—è –≤–∞—Ç–∞ (—Ä–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞)

## –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤
- `cart` - –≤ –∫–æ—Ä–∑–∏–Ω–µ
- `pending` - –æ–∂–∏–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `preparing` - –≥–æ—Ç–æ–≤–∏—Ç—Å—è
- `ready_for_pickup` - –≥–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ
- `completed` - –∑–∞–≤–µ—Ä—à–µ–Ω
- `cancelled` - –æ—Ç–º–µ–Ω–µ–Ω