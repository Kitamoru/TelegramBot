# Popcorn Shop Telegram Bot

## Обзор проекта
Telegram-бот для закусочной "Popcorn Shop" на TypeScript с использованием фреймворка Telegraf.js, базы данных Supabase и деплоем на Vercel Serverless Functions.

## Функциональность
- **Для покупателей**: заказ товаров, управление корзиной, отслеживание статуса заказов
- **Для продавцов**: обработка заказов, управление статусами, уведомления

## Технический стек
- **TypeScript** - основной язык разработки
- **Telegraf.js** - фреймворк для Telegram Bot API
- **Supabase** - база данных с RLS политиками
- **Vercel** - платформа деплоя с Serverless Functions
- **Node.js** - runtime окружение

## Структура проекта
```
├── api/
│   └── bot.ts              # Vercel Serverless Function
├── src/
│   ├── bot.ts              # Основная логика бота
│   ├── dev.ts              # Файл для разработки
│   ├── services/
│   │   └── supabase.ts     # Сервис работы с БД
│   ├── types/
│   │   └── index.ts        # TypeScript типы
│   └── utils/
│       └── cache.ts        # Кэширование
├── scripts/
│   ├── set-webhook.ts      # Установка webhook
│   └── get-webhook-info.ts # Информация о webhook
├── database/
│   └── schema.sql          # SQL схема для Supabase
├── vercel.json             # Конфигурация Vercel
└── package.json            # Зависимости и скрипты
```

## База данных (Supabase)
### Таблицы:
- `profiles` - пользователи (покупатели и продавцы)
- `products` - товары (попкорн, напитки, вата)
- `orders` - заказы
- `order_items` - позиции заказов

### RLS политики:
- Пользователи могут управлять только своими данными
- Продавцы видят заказы только своего буфета
- Атомарные обновления статусов для предотвращения race conditions

## Скрипты
- `npm run dev` - запуск в режиме разработки (polling)
- `npm run build` - сборка TypeScript
- `npm run set-webhook` - установка webhook для production
- `npm run webhook-info` - информация о текущем webhook

## Переменные окружения
```
BOT_TOKEN=ваш_токен_бота
SUPABASE_URL=url_проекта_supabase
SUPABASE_ANON_KEY=anon_ключ_supabase
WEBHOOK_SECRET=секрет_для_webhook
VERCEL_URL=url_vercel_деплоя
```

## Последние изменения
- 08.09.2025: Создана базовая структура проекта
- Реализована основная логика бота для покупателей и продавцов
- Настроен Supabase сервис с RLS политиками
- Добавлены Vercel Serverless Functions
- Создан кэш для оптимизации запросов к БД

## Пользовательские предпочтения
- Язык интерфейса: Русский
- Текстовый бот без веб-клиента
- Использование TypeScript для типобезопасности
- Готовность к продакшену с обработкой ошибок и логированием

## Архитектура проекта
- Модульная структура с разделением ответственности
- Кэширование товаров для уменьшения нагрузки на БД
- Атомарные операции для предотвращения конкурентного доступа
- Middleware для аутентификации пользователей
- Уведомления продавцов о новых заказах