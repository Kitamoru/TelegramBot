–¢—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π senior full-stack —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ TypeScript, Telegram –±–æ—Ç–∞—Ö –∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Vercel.

**–ó–∞–¥–∞—á–∞:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Telegram-–±–æ—Ç–∞ –¥–ª—è –∑–∞–∫—É—Å–æ—á–Ω–æ–π "Popcorn Shop" —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–º—É –Ω–∏–∂–µ –¢–ó. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–∑–≤–æ–ª—è—Ç—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã (–ø–æ–ø–∫–æ—Ä–Ω, –Ω–∞–ø–∏—Ç–∫–∏, –≤–∞—Ç–∞), –∞ –ø—Ä–æ–¥–∞–≤—Ü–∞–º ‚Äî –∏—Ö –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å.

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å—Ç–µ–∫—É:**
1.  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **TypeScript**.
2.  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ **Telegraf.js** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram Bot API.
3.  –î–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Supabase** (—Ç–∞–±–ª–∏—Ü—ã –∏ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –æ–ø–∏—Å–∞–Ω—ã –Ω–∏–∂–µ).
4.  –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ –Ω–∞ **Vercel** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Vercel Serverless Functions** –≤ —Ä–µ–∂–∏–º–µ Webhook.
5.  –ö–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É: —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–æ–≤.

---

### **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ (—Å–æ–∫—Ä–∞—â–µ–Ω–Ω–∞—è –∏ —É—Ç–æ—á–Ω–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)**

**1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Supabase)**
–°–æ–∑–¥–∞–π —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º RLS (Row Level Security) –∏ —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏:
*   `profiles` (`user_id` BIGINT PRIMARY KEY, `username` TEXT, `full_name` TEXT, `role` TEXT DEFAULT 'customer', `created_at` TIMESTAMPTZ DEFAULT NOW())
    *   –ü–æ–ª–∏—Ç–∏–∫–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ—é –∑–∞–ø–∏—Å—å (`auth.uid() = user_id`).
*   `products` (`id` SERIAL PRIMARY KEY, `name` TEXT, `category` TEXT, `price` DECIMAL, `is_available` BOOLEAN DEFAULT TRUE)
    *   –ü–æ–ª–∏—Ç–∏–∫–∞: SELECT —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è –≤—Å–µ—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
*   `orders` (`id` SERIAL PRIMARY KEY, `customer_id` BIGINT REFERENCES `profiles`(`user_id`), `status` TEXT DEFAULT 'cart', `pickup_location` TEXT, `total_amount` DECIMAL DEFAULT 0, `created_at` TIMESTAMPTZ DEFAULT NOW(), `updated_at` TIMESTAMPTZ DEFAULT NOW())
    *   –¢—Ä–∏–≥–≥–µ—Ä: —Å–æ–∑–¥–∞–π —Ç—Ä–∏–≥–≥–µ—Ä `update_orders_updated_at` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `updated_at` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫–∏.
    *   –ü–æ–ª–∏—Ç–∏–∫–∏:
        *   –ü–æ–∫—É–ø–∞—Ç–µ–ª–∏: –º–æ–≥—É—Ç –¥–µ–ª–∞—Ç—å CRUD —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–∏—Ö –∑–∞–∫–∞–∑–æ–≤ (`customer_id = auth.uid()`).
        *   –ü—Ä–æ–¥–∞–≤—Ü—ã (`seller_left`): –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å/–æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–∫–∞–∑—ã —Å `pickup_location = 'left_buffer'`.
        *   –ü—Ä–æ–¥–∞–≤—Ü—ã (`seller_right`): –º–æ–≥—É—Ç —á–∏—Ç–∞—Ç—å/–æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–∫–∞–∑—ã —Å `pickup_location = 'right_buffer'`.
*   `order_items` (`id` SERIAL PRIMARY KEY, `order_id` INT REFERENCES `orders`(`id`), `product_id` INT REFERENCES `products`(`id`), `quantity` INT, `price_at_time` DECIMAL)
    *   –ü–æ–ª–∏—Ç–∏–∫–∞: –ù–∞—Å–ª–µ–¥—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ JOIN –∫ —Ç–∞–±–ª–∏—Ü–µ `orders`.

**2. –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ (Key Scenarios)**
–†–µ–∞–ª–∏–∑—É–π —Å—Ü–µ–Ω–∞—Ä–Ω—É—é –ª–æ–≥–∏–∫—É —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `Scenes` –∏–ª–∏ `Composer` –≤ Telegraf.

*   **–î–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª—è (`customer`):**
    *   `/start`: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ. –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏: "üçø –ó–∞–∫–∞–∑–∞—Ç—å", "üõí –ö–æ—Ä–∑–∏–Ω–∞ (N)", "üìã –ú–æ–∏ –∑–∞–∫–∞–∑—ã".
    *   "–ó–∞–∫–∞–∑–∞—Ç—å": –ü–æ–∫–∞–∂–∏ –º–µ–Ω—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π -> —Ç–æ–≤–∞—Ä—ã —Å –∫–Ω–æ–ø–∫–æ–π "–î–æ–±–∞–≤–∏—Ç—å (+)".
    *   –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: –Ω–∞–π–¥–∏ –∏–ª–∏ —Å–æ–∑–¥–∞–π –∑–∞–∫–∞–∑ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `cart`. –û–±–Ω–æ–≤–∏ `order_items` –∏ `total_amount`.
    *   "–ö–æ—Ä–∑–∏–Ω–∞": –ü–æ–∫–∞–∂–∏ —Å–æ—Å—Ç–∞–≤, —Å—É–º–º—É, –∫–Ω–æ–ø–∫–∏ "–ò–∑–º–µ–Ω–∏—Ç—å", "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑".
    *   –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ: –∑–∞–ø—Ä–æ—Å–∏ `pickup_location` (–õ–µ–≤—ã–π/–ü—Ä–∞–≤—ã–π –±—É—Ñ–µ—Ç). –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–º–µ–Ω–∏ —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –Ω–∞ `pending` –∏ **–æ—Ç–ø—Ä–∞–≤—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü–∞–º** —ç—Ç–æ–≥–æ –±—É—Ñ–µ—Ç–∞. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞, –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∏ –∫–Ω–æ–ø–∫—É "üë®‚Äçüç≥ –í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É".
    *   –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞: –µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–∫–∞–∑ (–Ω–µ `cart`/`completed`/`cancelled`), –ø–æ–∫–∞–∑—ã–≤–∞–π –µ–≥–æ —Å—Ç–∞—Ç—É—Å –∏ –±–ª–æ–∫–∏—Ä—É–π —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ.

*   **–î–ª—è –ø—Ä–æ–¥–∞–≤—Ü–∞ (`seller_left`/`seller_right`):**
    *   `/start`: –ü–∞–Ω–µ–ª—å —Å –∫–Ω–æ–ø–∫–∞–º–∏: "üì• –ù–æ–≤—ã–µ", "üë®‚Äçüç≥ –í —Ä–∞–±–æ—Ç–µ", "‚úÖ –ì–æ—Ç–æ–≤—ã–µ".
    *   –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –∑–∞–∫–∞–∑–µ (`pending`) –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ–¥–∞–≤—Ü–∞–º –Ω—É–∂–Ω–æ–≥–æ –±—É—Ñ–µ—Ç–∞.
    *   "–í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É": –ê—Ç–æ–º–∞—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—å –∏ –∏–∑–º–µ–Ω–∏ —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ —Å `pending` –Ω–∞ `preparing` (–∏—Å–ø–æ–ª—å–∑—É–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–ª–∏ `SELECT FOR UPDATE` –≤ Supabase –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è race condition).
    *   –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è: "‚úÖ –ì–æ—Ç–æ–≤–æ" -> —Å—Ç–∞—Ç—É—Å `ready_for_pickup` (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—é), "üì¶ –í—ã–¥–∞–Ω" -> —Å—Ç–∞—Ç—É—Å `completed`.

**3. –î–µ–ø–ª–æ–π –Ω–∞ Vercel**
*   –°–æ–∑–¥–∞–π Serverless Function –≤ —Ñ–∞–π–ª–µ `api/bot.ts`.
*   –ò—Å–ø–æ–ª—å–∑—É–π `vercel.json` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –≤–µ–±—Ö—É–∫–∞.
*   –ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–¥—É—é—â–∏–µ Environment Variables –≤ Vercel:
    *   `BOT_TOKEN`, `SUPABASE_URL`, `SUPABASE_ANON_KEY`
    *   `WEBHOOK_SECRET` (–¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤)
    *   `VERCEL_URL` (–¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–µ–±—Ö—É–∫–∞)

**4. –í–∞–∂–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –Ω—é–∞–Ω—Å—ã**
*   **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ–±—Ö—É–∫–∞:** –ù–∞–ø–∏—à–∏ —Å–∫—Ä–∏–ø—Ç (`scripts/set-webhook.ts`), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å URL –≤–µ–±—Ö—É–∫–∞ –Ω–∞ Vercel –ø—Ä–∏ –¥–µ–ø–ª–æ–µ. –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `BOT_TOKEN` –∏ `VERCEL_URL`.
*   **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤–µ–±—Ö—É–∫–∞:** –í `api/bot.ts` —Ä–µ–∞–ª–∏–∑—É–π –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É (middleware) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ `WEBHOOK_SECRET` –∏–ª–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤.
*   **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** –î–ª—è –º–µ–Ω—é —Ç–æ–≤–∞—Ä–æ–≤ —Ä–µ–∞–ª–∏–∑—É–π –ø—Ä–æ—Å—Ç–æ–π in-memory –∫—ç—à –Ω–∞ 5 –º–∏–Ω—É—Ç, —á—Ç–æ–±—ã –Ω–µ –Ω–∞–≥—Ä—É–∂–∞—Ç—å –ë–î.
*   **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π `console.log`/`console.error` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π –∏ –æ—à–∏–±–æ–∫. Vercel –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å –∏—Ö —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –ª–æ–≥-—Å–µ—Ä–≤–∏—Å–æ–º.

–ù–∞—á–Ω–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ (npm init), —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (telegraf, supabase, node-fetch –∏ —Ç.–¥.) –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ TypeScript. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å –ø–æ–ª–Ω—ã–π, –≥–æ—Ç–æ–≤—ã–π –∫ –¥–µ–ø–ª–æ—é –∫–æ–¥.